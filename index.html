<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini App Example</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @font-face {
            font-family: Archive Ukr;
            src: url(ArchiveUkr.ttf);
        }
        .main {
            background-color: #ffffff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }
        .elipse {
            position: relative;
            display: inline-block;
            justify-content: center;
        }
        .btn_grid{}
        .buttons{
            display: flex;
            justify-content: space-between;
            gap:20%;
        }
        button{
            background-color: #A099F6;
            color: white;
            width:40%;
            flex: 1 0 auto;
            padding:0 10px;
            border: 0px solid;
            border-radius: 10px;
        }
        .person {
            position: absolute;
            left: 50%;
            top:30%;
            transform: translate(-50%, -50%);
        }
        .person img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .text{
            font-family: Archive Ukr;
        }
        .loading {
            text-align: center;
            padding: 20px;
            font-family: Archive Ukr;
            color: #A099F6;
            font-size: 18px;
        }
        .completed-badge {
            background: #4CAF50;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .error { color: #ff4444 !important; }
        .debug { font-size: 12px; color: #666; margin-top: 10px; }
    </style>
</head>
<body>
    <div id="mainApp" class="main">
        <div class="elipse">
            <div>
                <img src="Ellipse 6.svg" alt="Ellipse"/>
                <img class="person" src="freepik__pixel-art-fulllength-child-wearing-a-unicorn-hat-o__30059 1.svg" alt="Person"/>
            </div>
            <div id="loading" class="loading">üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–≤–æ–∏ –∑–∞–¥–∞–Ω–∏—è...</div>
            
            <div id="stats" style="display:none; text-align:center; margin:20px 0; font-family: Archive Ukr;">
                <div style="font-size:18px; color:#A099F6;">
                    üìä <span id="done-count">0</span> –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –∏–∑ 25
                </div>
                <div id="user-id-display" class="debug"></div>
            </div>
            
            <div class="btn_grid" id="btnGrid" style="display:none;">
                <div class="buttons">
                    <button class="text" data-category="–î—Ä—É–∂–µ–ª—é–±–Ω–æ—Å—Ç—å">
                        –î—Ä—É–∂–µ–ª—é–±–Ω–æ—Å—Ç—å <span id="count-–¥—Ä—É–∂–µ–ª—é–±–Ω–æ—Å—Ç—å" class="completed-badge"></span>
                    </button>
                    <button class="text" data-category="–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç">
                        –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç <span id="count-–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç" class="completed-badge"></span>
                    </button>
                </div>
                <div class="buttons">
                    <button class="text" data-category="–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å">
                        –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å <span id="count-–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å" class="completed-badge"></span>
                    </button>
                    <button class="text" data-category="–õ–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç">
                        –õ–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç <span id="count-–ª–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç" class="completed-badge"></span>
                    </button>
                </div>
            </div>
            <button id="creativeBtn" class="text" data-category="–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ" style="display:none;">
                –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ <span id="count-—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ" class="completed-badge"></span>
            </button>
            <span id="user-data"></span>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let userTasks = {};
        let doneTasks = [];
        let userId = null;
        let pendingCount = 25;

        document.getElementById('user-data').textContent = tg.initDataUnsafe?.user?.first_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';

        // üî• –ö–ê–†–¢–ê –ò –ó–ê–î–ê–ù–ò–Ø (—Ç–≤–æ–∏)
        const categoryToTasks = {
            '–î—Ä—É–∂–µ–ª—é–±–Ω–æ—Å—Ç—å': ['21','22','23','24','25'],
            '–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å': ['11','12','13','14','15'],
            '–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç': ['31','32','33','34','35'],
            '–õ–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç': ['41','42','43','44','45'],
            '–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ': ['51','52','53','54','55']
        };

        const tasks = {
            "–õ–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç": {
                "41": "–ù–∞–ø–∏—Å–∞—Ç—å 3 –∏–≥—Ä—ã –Ω–∞ –≤—Ç–æ—Ä–∏—á–Ω–æ–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ: –ü–æ–¥—Ä–æ–±–Ω–æ —Ä–∞—Å–ø–∏—à–∏ 3 –ª—é–±—ã–µ –∏–≥—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥—É—Ç –¥–µ—Ç—è–º –±—ã—Å—Ç—Ä–æ –∏ –≤–µ—Å–µ–ª–æ –∑–∞–∫—Ä–µ–ø–∏—Ç—å –∑–Ω–∞–Ω–∏—è –∏–º–µ–Ω –¥—Ä—É–≥ –¥—Ä—É–≥–∞.",
                "42": "–ù–∞–ø–∏—Å–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ –∫–µ–π—Å–∞: –¢–≤–æ–∏–º –¥–µ—Ç—è–º –ø–æ 7 –ª–µ—Ç. –î–≤–æ–µ —Ä–µ–±—è—Ç –≤ –æ—Ç—Ä—è–¥–µ –ø–æ—Å—Å–æ—Ä–∏–ª–∏—Å—å –∏–∑‚Äë–∑–∞ —Ç–æ–≥–æ, –∫—Ç–æ –±—É–¥–µ—Ç –≤–µ–¥—É—â–∏–º –≤ –∏–≥—Ä–µ.",
                "43": "–ó–∞–¥–∞—Ç—å 1 –≤–æ–ø—Ä–æ—Å –≤ —Ç–µ—á–µ–Ω–∏–µ –ª–µ–∫—Ü–∏–∏ —Å–ø–∏–∫–µ—Ä—É (–ø–æ –¥–µ–ª—É, –±–µ–∑ —à—É—Ç–æ–∫): –î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–∏ —Ç—ã —Å–ª—É—à–∞–µ—à—å —Å–ø–∏–∫–µ—Ä–∞ –∏–ª–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏—Ç–≤–æ—Ä—è–µ—à—å—Å—è? –ó–∞–¥–∞–π –µ–º—É –≤–æ–ø—Ä–æ—Å –ø–æ —Ç–µ–º–µ –∏ –ø—Ä–∏—à–ª–∏ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –µ–≥–æ –æ—Ç–≤–µ—Ç–æ–º –≤ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.",
                "44": "–í—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è —Å –∫—É—Ä–∞—Ç–æ—Ä–æ–º –≤–Ω–µ –∑–∞–Ω
