<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–í–î'26 - –ü—Ä–æ–∫–∞—á–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –¢–≤–æ–π CSS –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        @font-face { font-family: Archive Ukr; src: url(ArchiveUkr.ttf); }
        .main { background-color: #ffffff; min-height: 100vh; display: flex; justify-content: center; }
        .elipse { position: relative; display: inline-block; justify-content: center; }
        .buttons { display: flex; justify-content: space-between; gap: 20%; }
        button { background-color: #A099F6; color: white; width: 40%; flex: 1 0 auto; padding: 0 10px; border: none; border-radius: 10px; }
        .person { position: absolute; left: 50%; top: 30%; transform: translate(-50%, -50%); }
        .person img { width: 100%; height: 100%; object-fit: contain; }
        .text { font-family: 'Archive Ukr'; }
    </style>
</head>
<body>
    <div id="mainApp" class="main">
        <div class="elipse">
            <div>
                <img src="Ellipse 6.svg" alt="Ellipse"/>
                <img class="person" src="freepik__pixel-art-fulllength-child-wearing-a-unicorn-hat-o__30059 1.svg" alt="Person"/>
            </div>
            <div class="btn_grid">
                <div class="buttons">
                    <button class="text" data-category="–î—Ä—É–∂–µ–ª—é–±–Ω–æ—Å—Ç—å">–î—Ä—É–∂–µ–ª—é–±–Ω–æ—Å—Ç—å</button>
                    <button class="text" data-category="–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</button>
                </div>
                <div class="buttons">
                    <button class="text" data-category="–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</button>
                    <button class="text" data-category="–õ–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç">–õ–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç</button>
                </div>
            </div>
            <button class="text" data-category="–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ">–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ</button>
            <span id="user-data"></span>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        document.getElementById('user-data').textContent = 
            tg.initDataUnsafe.user ? tg.initDataUnsafe.user.first_name : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        
        // –°—Ç–∞—Ç–∏—á–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è (fallback)
        const tasks = {
            "–î—Ä—É–∂–µ–ª—é–±–Ω–æ—Å—Ç—å": {
                "–ü—Ä–æ–≥—É–ª—è—Ç—å—Å—è —Å –¥—Ä—É–≥–∏–º –∏–≥—Ä–æ–∫–æ–º": "–°—Ñ–æ—Ç–∫–∞–π—Ç–µ—Å—å –≤–º–µ—Å—Ç–µ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ!",
                "–ê–Ω–∫–µ—Ç–∞ –ª—É—á—à–µ–≥–æ –¥—Ä—É–≥–∞": "–£–∑–Ω–∞–π—Ç–µ 3 —Ñ–∞–∫—Ç–∞ –æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–µ",
                "–†–µ—Å–ø–µ–∫—Ç –¥—Ä—É–≥—É": "–ü–æ—Ö–≤–∞–ª–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã",
                "–ü–µ—Ä–µ–∫—É—Å –ø–æ —Ü–≤–µ—Ç–∞–º": "–¢–∏–∫—Ç–æ–∫-—á–µ–ª–ª–µ–Ω–¥–∂ —Å –≤–∫—É—Å–Ω—è—à–∫–∞–º–∏", 
                "–ü–∞—Ä–Ω—ã–π –∫–æ—Å—Ç—é–º": "–°–æ–∑–¥–∞–π—Ç–µ –∫–æ—Å—Ç—é–º—ã –≤–¥–≤–æ—ë–º"
            },
            "–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç": {
                "–î–ó #1 > 70 –±–∞–ª–ª–æ–≤": "–í—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–æ–º–∞—à–∫—É –Ω–∞ –æ—Ç–ª–∏—á–Ω–æ!",
                "–î–ó #2 > 70 –±–∞–ª–ª–æ–≤": "–í—Ç–æ—Ä–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –æ—Ç–ª–∏—á–Ω–æ!",
                "–î–ó #3 > 70 –±–∞–ª–ª–æ–≤": "–¢—Ä–µ—Ç—å–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –æ—Ç–ª–∏—á–Ω–æ!",
                "–î–ó #4 > 70 –±–∞–ª–ª–æ–≤": "–ß–µ—Ç–≤—ë—Ä—Ç–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –æ—Ç–ª–∏—á–Ω–æ!",
                "–î–ó #5 > 70 –±–∞–ª–ª–æ–≤": "–ü—è—Ç–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –æ—Ç–ª–∏—á–Ω–æ!"
            },
            "–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å": {
                "–¢–∞–Ω—Ü—ã –Ω–∞ —Å—Ü–µ–Ω–µ": "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Å—å –∫ —Ç–∞–Ω—Ü–∞–º –∏–ª–∏ —Å–¥–µ–ª–∞–π –Ω–æ–º–µ—Ä!",
                "–ò–≥—Ä–∞ —Å –∑–∞–ª–æ–º": "–ü—Ä–æ–≤–µ–¥–∏ –º–∏–Ω–∏-–∏–≥—Ä—É –¥–ª—è –≤—Å–µ—Ö",
                "–ú–∏–Ω–∏-—Å—é—Ä–ø—Ä–∏–∑": "–ü–æ—Ä–∞–¥—É–π –≤—Å–µ—Ö –±–µ—Å–ø–ª–∞—Ç–Ω–æ",
                "–ü–æ–±–µ–¥–∞ –≤ –∫–æ–Ω–∫—É—Ä—Å–µ": "–ó–∞–±–µ—Ä–∏ –≥—Ä–∞–º–æ—Ç—É!",
                "3 —Å—Ç–æ—Ä–∏—Å –æ –¥–Ω–µ": "–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–≤–æ—ë–º –¥–Ω–µ"
            },
            "–õ–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç": {
                "3 –∏–≥—Ä—ã –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞": "–ü—Ä–∏–¥—É–º–∞–π –∏–≥—Ä—ã –¥–ª—è –¥–µ—Ç–µ–π",
                "–†–µ—à–µ–Ω–∏–µ –∫–µ–π—Å–∞": "–†–∞–∑–±–µ—Ä–∏ —Å—Å–æ—Ä—É 7-–ª–µ—Ç–æ–∫",
                "–í–æ–ø—Ä–æ—Å —Å–ø–∏–∫–µ—Ä—É": "–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –Ω–∞ –ª–µ–∫—Ü–∏–∏",
                "–í—Å—Ç—Ä–µ—á–∞ —Å –∫—É—Ä–∞—Ç–æ—Ä–æ–º": "–§–æ—Ç–æ —Å –∫—É—Ä–∞—Ç–æ—Ä–æ–º –≤–Ω–µ –∑–∞–Ω—è—Ç–∏–π", 
                "–¢–∞–π–Ω–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞": "–£–∑–Ω–∞–π —Å–µ–∫—Ä–µ—Ç –æ–¥–Ω–æ–≥–æ –∏–∑ –Ω–∞—Å"
            },
            "–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ": {
                "–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ": "–†–∏–ª—Å/–¢–∏–∫–¢–æ–∫ —Å #–®–í–î26",
                "–ö–æ—Å–ø–ª–µ–π –º–µ–º–∞": "–ó–∞–∫–æ—Å–ø–ª–µ–π —Å–≤–æ–π –ª—é–±–∏–º—ã–π –º–µ–º",
                "2 –ø–µ–¥. —à—É—Ç–∫–∏": "–ü—Ä–∏–¥—É–º–∞–π —à—É—Ç–∫–∏ –¥–ª—è –¥–µ—Ç–µ–π",
                "–ö—Ä—É—Ç–æ–π –∫–æ—Å—Ç—é–º": "–í–∞—É-–∫–æ—Å—Ç—é–º –Ω–∞ –∑–∞–Ω—è—Ç–∏–µ",
                "–¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤–∞—Ç–∞—Ä–∫–∞": "–ê–≤–∞—Ç–∞—Ä–∫–∞ —Å –®–í–î'26"
            }
        };
        
        let currentProgress = {};
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        async function loadProgress() {
            const userId = tg.initDataUnsafe.user?.id;
            if (userId) {
                tg.sendData(JSON.stringify({
                    action: 'get_progress',
                    user_id: userId
                }));
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è toggle –¥–ª—è –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞
        window.toggleTask = function(index) {
            const desc = document.getElementById(`task-desc-${index}`);
            const header = document.querySelector(`.task-header-${index}`);
            const arrow = header.querySelector('span');
            
            if (desc.style.maxHeight === '0px' || !desc.style.maxHeight) {
                desc.style.maxHeight = desc.scrollHeight + 'px';
                arrow.textContent = '‚ñ≤';
            } else {
                desc.style.maxHeight = '0px';
                arrow.textContent = '‚ñº';
            }
        };
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª–∫—É —Å –∑–∞–¥–∞–Ω–∏—è–º–∏
        async function showModal(category) {
            const userId = tg.initDataUnsafe.user?.id;
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.style.cssText = `
                position:fixed;top:0;left:0;width:100%;height:100%;
                background:rgba(0,0,0,0.5);z-index:9999;display:flex;
                justify-content:center;align-items:center;
            `;
            
            modal.innerHTML = `
                <div style="
                    background:#A099F6;border-radius:15px;width:90%;max-height:80%;
                    padding:20px;overflow:auto;color:white;font-family:'Archive Ukr';
                ">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                        <h1 style="margin:0;font-size:24px;">${category}</h1>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()"
                            style="padding:8px;background:white;color:#AFCB6F;border:none;border-radius:50px;cursor:pointer;font-size:20px;width:50px;height:50px;font-weight:bold;">
                            ‚úï
                        </button>
                    </div>
                    <div style="background:white;height:2px;margin-bottom:10px;"></div>
                    <div class="tasks-container" style="text-align:center;">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–¥–∞–Ω–∏—è
            const colName = Object.keys(CATEGORY_MAP).find(k => CATEGORY_MAP[k] === category.toLowerCase()) || 'friend';
            const completed = currentProgress[colName] || 0;
            
            setTimeout(() => {
                const allTasks = tasks[category] || {};
                const visibleTasks = Object.entries(allTasks).slice(0, 5 - completed);
                
                let tasksHTML = '';
                visibleTasks.forEach(([name, desc], index) => {
                    tasksHTML += `
                        <div style="margin-bottom:15px;background:white;border-radius:10px;overflow:hidden;">
                            <div onclick="toggleTask(${index})" class="task-header-${index}" style="
                                padding:15px;cursor:pointer;background:#EDE8FF;
                                color:#5F33E1;font-weight:bold;font-size:18px;user-select:none;
                            ">
                                ${name} üìã
                                <span style="float:right;font-size:14px;color:#A099F6;">‚ñº</span>
                            </div>
                            <div id="task-desc-${index}" style="
                                max-height:0;overflow:hidden;transition:max-height 0.3s ease;
                                background:white;color:#666;padding:0 20px;
                            ">
                                <div style="line-height:1.5;padding:15px 0;">${desc}</div>
                                <button onclick="markComplete('${category}', ${index})"
                                    style="width:100%;padding:12px;background:#00d4ff;color:white;border:none;border-radius:10px;font-weight:bold;font-family:'Archive Ukr';">
                                    ‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                if (visibleTasks.length === 0) {
                    tasksHTML = '<div style="padding:30px;color:#999;">üéâ –í—Å–µ –∑–∞–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã!</div>';
                }
                
                modal.querySelector('.tasks-container').innerHTML = tasksHTML;
            }, 500);
        }
        
        // –û—Ç–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º
        async function markComplete(category, taskIndex) {
            const userId = tg.initDataUnsafe.user?.id;
            tg.sendData(JSON.stringify({
                action: 'complete_task',
                user_id: userId,
                category: category,
                task_index: taskIndex
            }));
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥–∞–ª–∫—É —á–µ—Ä–µ–∑ 1 —Å–µ–∫
            setTimeout(() => {
                document.querySelector('.modal-overlay')?.remove();
                showModal(category);
            }, 1000);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        document.querySelectorAll('button[data-category]').forEach(button => {
            button.onclick = () => showModal(button.dataset.category);
        });
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        loadProgress();
        
        // –°–ª—É—à–∞–µ–º –æ—Ç–≤–µ—Ç—ã –æ—Ç –±–æ—Ç–∞
        tg.onEvent('webAppData', (data) => {
            try {
                const response = JSON.parse(data);
                if (response.progress) {
                    currentProgress = response.progress;
                }
            } catch(e) {}
        });
    </script>
</body>
</html>
